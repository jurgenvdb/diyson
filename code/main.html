<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <!-- main toggle switch to turn on -->
    <label class="switch">
        <input type="checkbox" id="toggle" name="toggle" onchange="update(this)">
        <!-- <span class="slider round"></span><br> -->
    </label>

    <!-- slider for brightness and temperature -->
    <div id="slidecontainer" style="display:none" class="slidecontainer">
        <label for="brightness">Brightness:</label>
        <input type="range" min="0" max="255" value="0" class="slider" id="brightness" name="brightness_slider"
            onchange="update(this)">
        <input type="number" id="brightnessValue" name="brightness_output" value="0" min="0" max="255"><br>

        <label for="temperature">Temperature:</label>
        <input type="range" min="0" max="255" value="0" class="slider" id="temperature" name="temperature_slider"
            onchange="update(this)">
        <input type="number" id="temperatureValue" name="temperature_output" value="0" min="0" max="255">
    </div>

    <script>
        var brightness_slider = document.getElementById("brightness");
        var brightness_output = document.getElementById("brightnessValue");
        var temperature_slider = document.getElementById("temperature");
        var temperature_output = document.getElementById("temperatureValue");
        var toggle_button = document.getElementById("toggle");
        var slidecontainer = document.getElementById("slidecontainer");
        brightness_output.value = brightness_slider.value;
        temperature_output.value = temperature_slider.value;
        brightness_slider.oninput = function () {
            brightness_output.value = this.value;
            update(this);
        }
        brightness_output.oninput = function () {
            if (this.value > 255) {
                this.value = 255;
            } else if (this.value < 0) {
                this.value = 0;
            }
            brightness_slider.value = this.value;
            update(this);
        }
        temperature_slider.oninput = function () {
            temperature_output.value = this.value;
            update(this);
        }
        temperature_output.oninput = function () {
            if (this.value > 255) {
                this.value = 255;
            } else if (this.value < 0) {
                this.value = 0;
            }
            temperature_slider.value = this.value;
            update(this);
        }
        toggle_button.onchange = function () {
            if (toggle_button.checked) {
                slidecontainer.style.display = "block";
            } else {
                slidecontainer.style.display = "none";
            }
            update(this);
        }

        function update(element) {
            var xhr = new XMLHttpRequest();
            if (element.id == "toggle") {
                if (element.checked) {
                    xhr.open("GET", "/update?output=toggle&state=1", true);
                } else {
                    xhr.open("GET", "/update?output=toggle&state=0", true);
                }
            } else {
                if (element.name.includes("brightness")) {
                    xhr.open("GET", "/update?output=brightness&state=" + element.value, true);
                } else if (element.name.includes("temperature")) {
                    xhr.open("GET", "/update?output=temperature&state=" + element.value, true);
                }
            }
            xhr.send();
        }

    </script>
</body>
</html>